language: node_js
node_js:
  - '8'

cache:
  - elm-stuff/build-artifacts
  - tests/elm-stuff/build-artifacts

install:
  - npm i -g npm@latest
  - npm i -g elm@0.19
  - npm install

script:
  - npm run build
  - mkdir it && cp -r !(it|node_modules|elm-stuff) it/ && cd it && npm i && elm make elm/Main.elm --output=/dev/null
  - npm run test:it
  - cd .. && rm -rf it

deploy:
  provider: surge
  skip_cleanup: true
